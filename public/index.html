<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>ATIS Lookup</title></head><body>
<div><h1>ATIS Lookup</h1>
    <form id="form">
        <input id="icao" placeholder="ICAO code" />
        <button type="submit">Get ATIS</button>
    </form>
    <button id="save-btn" disabled>Save</button>
    <button id="show-btn" disabled>Show Last 5</button>
    <pre id="result"></pre>
</div>
<script>
    const f=document.getElementById('form'), i=document.getElementById('icao'), r=document.getElementById('result');
    const s=document.getElementById('save-btn'), sh=document.getElementById('show-btn');
    let last='';
    f.addEventListener('submit',async e=>{
        e.preventDefault(); last=i.value.trim().toUpperCase(); if(!last)return;
        r.textContent='Loading…'; s.disabled=sh.disabled=true;
        const res=await fetch(`/atis/${last}`);
        if(!res.ok){ r.textContent=`Error ${res.status}`;return; }
        const d=await res.json(); r.textContent=d.atis_raw;
        s.disabled=sh.disabled=false;
    });
    s.addEventListener('click',async()=>{
        r.textContent='Saving…';
        const res=await fetch(`/save-atis/${last}`,{method:'POST'});
        r.textContent=res.ok?'✅ Saved':'❌ Save failed';
    });
    sh.addEventListener('click',async()=>{
        r.textContent='Loading saved…';
        const res=await fetch(`/saved-atis/${last}`);
        const arr=await res.json();
        r.textContent=arr.map(x=>`${new Date(x.saved_at).toLocaleString()}\n${x.atis_raw}`).join('\n\n');
    });
</script></body></html>